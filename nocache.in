#!/bin/bash

export LD_PRELOAD="##libdir##/nocache.so $LD_PRELOAD"

if [ "$1" = "-n" ]; then
    export NOCACHE_NR_FADVISE="$2"
    shift 2
fi

while getopts "n:D:" opt; do
case "$opt" in
    n) export NOCACHE_NR_FADVISE="$OPTARG" ;;
    D) exec {debugfd}>"$OPTARG";
       export NOCACHE_DEBUGFD="$debugfd"
       ;;
esac
done
shift $((OPTIND-1))

echo "[nocache] DEBUG: Executing: $@" >&$debugfd
exec "$@"
